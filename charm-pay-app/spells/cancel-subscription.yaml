version: 8

# This spell cancels a subscription and refunds remaining balance
# It marks the subscription as cancelled (remaining=0) and returns all tokens to subscriber
# Note: Contract requires NFT in outputs for token validation, so we output cancelled NFT

apps:
  $00: n/${app_id}/${app_vk}  # NFT app for subscription state
  $01: t/${app_id}/${app_vk}  # Token app for refund

ins:
  # Input 1: Subscription NFT (to be cancelled)
  - utxo_id: ${subscription_utxo}
    charms:
      $00:
        ticker: SUBSCRIPTION-${subscription_id}
        remaining: ${remaining_balance}  # Remaining balance to refund
  # Input 2: Remaining locked tokens
  - utxo_id: ${token_utxo}
    charms:
      $01: ${remaining_balance}  # Tokens to refund

outs:
  # Output 1: Cancelled subscription NFT (remaining=0 indicates cancelled)
  - address: ${subscriber_addr}
    charms:
      $00:
        ticker: SUBSCRIPTION-${subscription_id}-CANCELLED
        remaining: 0  # Zero remaining = cancelled subscription
  # Output 2: Refund all remaining tokens to subscriber
  - address: ${subscriber_addr}
    charms:
      $01: ${remaining_balance}  # Full refund of remaining balance

